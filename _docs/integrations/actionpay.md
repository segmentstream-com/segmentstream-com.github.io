---
layout: page
section: integrations
title: "Actionpay"
order: 1
---

В данном разделе вы узнаете:
* Как подключить или отключить Actionpay на вашем сайте.
* Как настроить дедупликацию платных каналов.
* Как подключить модуль ретаргетинга APRT.

Actionpay - партнерская сеть, объединяющая рекламодателей и веб-мастеров. SegmentStream позволяет отправлять данные о покупках ваших покупателей в Actionpay.

### Навигация по странице
------
<ul class="page-navigation">
  <li><a href="#0">Введение</a></li>
  <li><a href="#0_1">Условия для подключения</a></li>
  <li>Настройки:</li>
  <ul>
    <li><a href="#1">ID цели по умолчанию</a></li>
    <li><a href="#2">Название cookie, в которой хранится идентификатор партнера</a></li>
    <li><a href="#3">Автоматический трекинг cookie</a></li>
    <li><a href="#4">Срок хранения cookie</a></li>
    <li><a href="#5">Домен cookie</a></li>
    <li><a href="#6">Активировать дедупликацию</a></li>
    <li><a href="#7">Список utm_medium, для которых необходимо активировать дедупликацию</a></li>
    <li><a href="#8">utm_source переходов из Actionpay</a></li>
    <li><a href="#9">Активировать APRT</a></li>
    <li><a href="#10">ID партнера APRT</a></li>
  </ul>
</ul>


### <a name="0"></a>Введение
------
С помощью SegmentStream можно установить пиксель ActionPay на страницу "Спасибо за покупку", настроить сохранение источника трафика и идентификатора партнера в cookie, а также подключить модуль APRT.

Чтобы настроить интеграцию с ActionPay:
1. Авторизуйтесь на сайте [segmentstream.com](https://admin.segmentstream.com/) и перейдите к панели управления интеграциями
2. Войдите на вкладку "Интеграции" и кликните по блоку с логотипом Admitad.
3. В открывшейся панели - настройте интеграцию.
![](/img/integrations.actionpay.1.png)
<br />
Подробнее о настройках вы можете прочитать ниже.

> Для работы базовой интеграции необходимо настроить событие "[Completed Transaction](/events/completed-transaction)"

### <a name="0_1"></a>Условия для подключения
------
Перед тем, как приступить к настройке интеграции в панели SegmentStream необходимо зарегистрироваться в подключаемой системе и подготовить все необходимые данные.

Запросите у менеджера ActionPay:
 - Тестовую ссылку
    - Важно чтобы ссылка содержала следующие GET_параметры: utm_medium, utm_source, utm_campaign, utm_content и actionpay. Если данных параметров нет или используются другие параметры, необходимо попросить менеджера ActionPay привести ссылку к формату http://www.test.ru/?actionpay=54a84dc8-b7ef-8eef-f018-0147002d634a.67345&utm_source=actionpay&utm_medium=cpa&utm_campaign=actionpay
 - ID_цели
 - Все возможные ID_цели и условия их применения, например:
    - 1 - покупка впервые
    - 2 - повторная покупка
      - или
    - 1 - покупка товаров из категории "Электроника"
    - 2 - покупка товаров из категории "Аксессуары"
    - 3 - ....
 - Идентификатор модуля APRT, в случае если его нужно подключать

 Также необходимы:
 - Ссылка на товарный фид для модуля APRT. Нужна для сравнения идентификаторов товаров в фиде и слое digitalData.
 - Если ActionPay уже работает на сайте, необходимо уточнить у разработчика или аналитика название cookie, в которую сохраняется значение параметра `actionpay`. После подключения интеграции через SegmentStream необходимо будет отключить заполнение cookie на стороне разработчиков.
 - Необходимо знать с какими каналами трафика utm_medium будет настроена дедупликация. Например: со всеми или только с CPA или CPA и CPC.

 Ниже более подробно описаны все поля настроек интеграции.

### <a name="1"></a>ID цели по умолчанию
------
ID цели - это уникальный идентификатор цели вашего проекта в системе ActionPay. Его необходимо уточнить у сотрудника ActionPay.

В зависимости от договоренностей с ActionPay у вас может быть одна или несколько ID цели. Например, если за первую покупку в вашем интернет-магазине платите одну цену, а за повторную - другую.

Если у вас несколько ID цели, необходимо будет настроить "Переменные событий".
В окне настроек интеграции ActionPay нажмите на вкладку "Переменные событий" и нажмите добавить.

Ниже приведен пример настройки различных кодов действия в зависимости от номера покупки посетителя:
![](/img/integrations.actionpay.2.png)


### <a name="2"></a>Название cookie, в которой хранится идентификатор партнера
------
В сети ActionPay у каждого рекламного объявления есть уникальный идентификатор. Этот идентификатор присутствует во всех рекламных ссылках, ведущих на ваш сайт, в качестве GET-параметра. Чтобы запомнить вебмастера, который привел вам потенциального покупателя, необходимо сохранить уникальный идентификатор в cookie. Тот вебмастер, чей номер окажется в cookie в момент оформления заказа, получит вознаграждение.

> Если ActionPay уже был интегрирован с вашим сайтом ранее, рекомендуем указать в настройках прежнее название cookie, чтобы идентификаторы партнеров, которые в течение последнего времени приводили трафик на сайт, не потерялись.

### <a name="3"></a>Автоматический трекинг cookie
------
SegmentStream умеет автоматически сохранять идентификатор партнера в cookie на определенный срок.
Включите тумблер "Автоматический трекинг cookie", укажите время хранения в днях а также домен cookie.

### <a name="4"></a>Срок хранения cookie
------
Укажите срок жизни cookie в днях. Срок должен быть указан в договоре c ActionPay


### <a name="5"></a>Домен cookie
------
Впишите доменное имя, которому будет доступна cookie

> Если разные разделы вашего сайта расположены на поддоменах, например корзина расположена по адресу checkout.site.ru, укажите домен верхнего уровня в настройках интеграции

### <a name="6"></a>Активировать дедупликацию
Дедупликация или атрибуция - это правило, в соответствии с которым ценность от выполненного заказа перераспределяется между всеми источниками трафика, которые приводили пользователя на сайт перед покупкой. В случае с партнерскими сетями чаще всего используется правило 'last cookie wins'. Это значит, что всю ценность забирает последний партнер.

По умолчанию дедупликация выключена. Это значит, что вебмастер, который приводил на сайт пользователя, получит свое вознаграждение не зависимо от того, приводили ли вебмастера других партнерских сетей или системы таргетированной и контекстной рекламы трафик на сайт позже.

Если включить дедупликацию, то система будет запоминать последний источник трафика (utm_source и utm_medium).
Если вы укажите список utm_medium, то SegmentStream не будет передавать в Admitad информацию о покупку, в случае если последний переход пользователя перед покупкой был с соответствующей utm_меткой. Например, если вы укажите 'cpc', то любые переходы из контекстной рекламы (если конечно так размечены объявления вашей контекстной рекламы) будут "затирать" предыдущие переходы по ссылкам вебмастеров.

Если вы укажите не один utm_medium, то любой переход по ссылке с любым utm_medium будет "затирать" предыдущие переходы по ссылкам вебмастеров.

> Если вы работаете одновременно с несколькими партнерскими сетями, настоятельно рекомендуем включить дедупликацию и указать utm_medium ссылок других партнерских сетей.

### <a name="7"></a>Список utm_medium, для которых необходимо активировать дедупликацию

### <a name="8"></a>utm_source переходов из Actionpay
Для корректной работы дедупликации и учета партнерских вознаграждений необходимо указать utm_source партнерских ссылок. Имя данного параметра лучше уточнить у сотрудника Actionpay.

### <a name="9"></a>Активировать APRT
По-умолчанию модуль ретаргетинга Actionpay отключен. Для его подключения необходимо активировать модуль APRT.
Для полноценной работы модуля ретаргетинга Actionpay на сайте должны быть настроены следующие события:
- Viewed Product Listing
- Viewed Product Detail
- Viewed Cart
- Viewed Checkout Step
- Added Product
- Removed Product
- Added Product to Wishlist
- Removed Product from Wishlist
- Registered

### <a name="10"></a>ID партнера APRT
Уточните идентификатор партнера APRT у менеджера Actionpay.
